<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <title>LED Controller</title>
  <meta name="viewport" content="width=400px" />

  <script src="socket.io/socket.io.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <br>
  <input type="range" id= "inputSliderBrush" min="1" max="3" value="1" step="1" oninput="showValueBrush(this.value)" />
  <br><h3>Brush: </h3><span id="outputTextBrush">1</span><br><br>

  <input type="range" id= "inputSliderBrightness" min="0" max="255" value="50" step="1" oninput="showValueBrightness(this.value)" />
  <br><h3>Brightness: </h3><span id="outputTextBrightness">50</span><br>
  <br>
  <input type="range" id= "inputSliderPressure" min="0" max="100" value="50" step="1" oninput="showValuePressure(this.value)" />
  <br><h3>Pressure: </h3><span id="outputTextPressure">50</span><br><br>

  <br>
  <input type="range" id= "inputSliderRed" min="0" max="255" value="50" step="1" oninput="showValueRed(this.value)" />
  <br><h3>Red: </h3><span id="outputTextRed">50</span><br><br>

  <br>
  <input type="range" id= "inputSliderGreen" min="0" max="255" value="50" step="1" oninput="showValueGreen(this.value)" />
  <br><h3>Green: </h3><span id="outputTextGreen">50</span><br><br>

  <br>
  <input type="range" id= "inputSliderBlue" min="0" max="255" value="50" step="1" oninput="showValueBlue(this.value)" />
  <br><h3>Blue: </h3><span id="outputTextBlue">50</span><br><br>

  <br><div id="html5DIV">
    <h3>LED Color Picker</h3>
    <input type="color" id="html5colorpicker" onchange="setColor()" value="#ff0000" style="width:85%;">
  </div>


  <script type="text/javascript">
  var socket = io.connect();
  var rtime;
  var timeout = false;
  var delta = 5;

  function setColor()
  {
    var newValue = document.getElementById("html5colorpicker").value;
    var colorRGB = hexToRgb(newValue);
    socket.emit('red', { value: colorRGB.r });
    socket.emit('green', { value: colorRGB.g });
    socket.emit('blue', { value: colorRGB.b });
  }
  function showValueBrush(newValue)
  {
    document.getElementById("outputTextBrush").innerHTML=newValue;
    socket.emit('brush', { value: newValue });
  }
  function showValueBrightness(newValue)
  {
    document.getElementById("outputTextBrightness").innerHTML=newValue;
    socket.emit('brightness', { value: newValue });
  }
  function showValueRed(newValue)
  {
    document.getElementById("outputTextRed").innerHTML=newValue;
    socket.emit('red', { value: newValue });
  }
  function showValueGreen(newValue)
  {
    document.getElementById("outputTextGreen").innerHTML=newValue;
    socket.emit('green', { value: newValue });
  }
  function showValueBlue(newValue)
  {
    document.getElementById("outputTextBlue").innerHTML=newValue;
    socket.emit('blue', { value: newValue });
  }

  function showValuePressure(newValue)
  {
    document.getElementById("outputTextPressure").innerHTML=newValue;
    rtime = new Date();
    if (timeout === false) {
      timeout = true;
      setTimeout(resizeend, delta);
    }
  }

  function resizeend() {
    if (new Date() - rtime < delta) {
      setTimeout(resizeend, delta);
    } else {
      timeout = false;

      socket.emit('pressure', { value: document.getElementById("outputTextPressure").innerHTML });
    }
  }

  function hexToRgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }
  function componentToHex(c) {
    var hex = c.toString(16);
    return hex.length == 1 ? "0" + hex : hex;
  }

  function rgbToHex(r, g, b) {
    return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
  }
</script>
</body>
</html>
